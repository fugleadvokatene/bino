package handlercalendar

import (
    "time"

    "fmt"

	"github.com/fugleadvokatene/bino/internal/language"
	"github.com/fugleadvokatene/bino/internal/request"
    "github.com/fugleadvokatene/bino/internal/templbase"
    "github.com/fugleadvokatene/bino/internal/calendar"
)

templ CalendarPage(data *request.CommonData, initialTime, initialView string) {
	@templbase.FullLayout(data) {
        <div class="h-100">
            <h1>{data.Language.Calendar}</h1>
            <div class="card p-2 w-100">
                <div id="calendar" data-initialdate={initialTime} data-initialview={initialView}>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.19/index.global.min.js"></script>
        <script src={data.StaticFile("calendar-locale-no.js")}></script>
        <script src={data.StaticFile("calendar.js")}></script>
    }
}

templ CalendarLink(formatter func(t time.Time) string, t time.Time, v string) {
    if !t.IsZero() {
        <a class="calendar-link" href={templ.URL(fmt.Sprintf("/calendar?t=%s&v=%s", t.Format(calendar.TimeFormatFullCalendarNoTZ), v))}>
            {formatter(t)}
        </a>
    } else {
        <span class="calendar-link calendar-link-never">
            {formatter(t)}
        </span>
    }
}

templ CalendarLinkAbs(lang *language.Language, t time.Time, v string) {
    @CalendarLink(lang.FormatDateAbs, t, v)
}

templ CalendarLinkRel(lang *language.Language, t time.Time, v string) {
    @CalendarLink(lang.FormatTimeRel, t, v)
}

templ CalendarLinkRelWithAbsFallback(lang *language.Language, t time.Time, v string) {
    @CalendarLink(lang.FormatTimeRelWithAbsFallback, t, v)
}

templ CalendarLinkAbsWithRelParen(lang *language.Language, t time.Time, v string) {
    @CalendarLink(lang.FormatTimeAbsWithRelParen, t, v)
}
