// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: sql-featureflag.sql

package sql

import (
	"context"
)

const clearFeatureFlagForUser = `-- name: ClearFeatureFlagForUser :exec
DELETE FROM feature_flag
WHERE
        flag       = $1
    AND appuser_id = $2
`

type ClearFeatureFlagForUserParams struct {
	Flag      string
	AppuserID int32
}

func (q *Queries) ClearFeatureFlagForUser(ctx context.Context, arg ClearFeatureFlagForUserParams) error {
	_, err := q.db.Exec(ctx, clearFeatureFlagForUser, arg.Flag, arg.AppuserID)
	return err
}

const createFeatureFlag = `-- name: CreateFeatureFlag :exec
INSERT INTO feature_flag (flag, appuser_id)
VALUES ($1, 0)
`

func (q *Queries) CreateFeatureFlag(ctx context.Context, flag string) error {
	_, err := q.db.Exec(ctx, createFeatureFlag, flag)
	return err
}

const deleteFeatureFlag = `-- name: DeleteFeatureFlag :exec
DELETE FROM feature_flag
WHERE flag = $1
`

func (q *Queries) DeleteFeatureFlag(ctx context.Context, flag string) error {
	_, err := q.db.Exec(ctx, deleteFeatureFlag, flag)
	return err
}

const getAllFeatureFlags = `-- name: GetAllFeatureFlags :many
SELECT
  u.id,
  u.display_name,
  f.flag,
  CASE WHEN ff.appuser_id IS NOT NULL THEN true ELSE false END AS is_set
FROM appuser u
CROSS JOIN (
  SELECT DISTINCT flag FROM feature_flag
) f
LEFT JOIN feature_flag ff
  ON ff.appuser_id = u.id
 AND ff.flag = f.flag
ORDER BY f.flag, u.id
`

type GetAllFeatureFlagsRow struct {
	ID          int32
	DisplayName string
	Flag        string
	IsSet       bool
}

func (q *Queries) GetAllFeatureFlags(ctx context.Context) ([]GetAllFeatureFlagsRow, error) {
	rows, err := q.db.Query(ctx, getAllFeatureFlags)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []GetAllFeatureFlagsRow
	for rows.Next() {
		var i GetAllFeatureFlagsRow
		if err := rows.Scan(
			&i.ID,
			&i.DisplayName,
			&i.Flag,
			&i.IsSet,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getFeatureFlagsForUser = `-- name: GetFeatureFlagsForUser :many
SELECT flag, appuser_id FROM feature_flag
WHERE appuser_id = $1
`

func (q *Queries) GetFeatureFlagsForUser(ctx context.Context, appuserID int32) ([]FeatureFlag, error) {
	rows, err := q.db.Query(ctx, getFeatureFlagsForUser, appuserID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []FeatureFlag
	for rows.Next() {
		var i FeatureFlag
		if err := rows.Scan(&i.Flag, &i.AppuserID); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const setFeatureFlagForUser = `-- name: SetFeatureFlagForUser :exec
INSERT INTO feature_flag (flag, appuser_id)
VALUES ($1, $2)
`

type SetFeatureFlagForUserParams struct {
	Flag      string
	AppuserID int32
}

func (q *Queries) SetFeatureFlagForUser(ctx context.Context, arg SetFeatureFlagForUserParams) error {
	_, err := q.db.Exec(ctx, setFeatureFlagForUser, arg.Flag, arg.AppuserID)
	return err
}
